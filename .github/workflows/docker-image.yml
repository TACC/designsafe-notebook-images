name: Docker Image CI

on:
  push:
    branches: [ main, dev ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Get 
      run: "image_name=`grep -E "LABEL image_name=" ./base/Dockerfile | sed 's/^LABEL image_name=\"\([^ ]*\)\"/\1/'`" >> $GITHUB_ENV


    - name: Build Docker Image (base)
      run: docker build ./base/ --no-cache=true --tag ${env.image_name}
    
    - name: Push Docker Image (base)
      run: docker push --tag ${env.image_name}
