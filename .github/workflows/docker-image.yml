name: Docker Image CI

on:
  push:
    branches: [ main, dev ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Build Docker Image (base)
      run: IMAGE_NAME=`grep -E "LABEL image_name=" ./base/Dockerfile | sed 's/^LABEL image_name=\"\([^ ]*\)\"/\1/'`
      run: docker build ./base/ --no-cache=true --tag ${IMAGE_NAME}
    
    - name: Push Docker Image (base)
      run: docker push --tag ${IMAGE_NAME}
